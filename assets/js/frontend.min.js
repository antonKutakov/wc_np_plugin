!function(e){let t={ref:"0"},o={ref:"0"},n="0"!=e("#weight").text()?e("#weight").text():"0.3",a={cost:"0"},r={type:"DoorsDoors"},s=e("#cargotype").val();function c(t="",o=""){e(t).has(o)&&e(t).empty()}function i(t="",o=""){e(t).append(o)}e("#wusd_area").select2({placeholder:"Оберіть область",allowClear:!0}),e("#wusd_city").select2({placeholder:"Оберіть місто",allowClear:!0}),e("#wusd_warehouse").select2({placeholder:"Оберіть відділення",allowClear:!0}),e("#wusd_shippingtype").select2({placeholder:"Оберіть тип доставки",allowClear:!0}),e("#wusd_area").change(function(){e(this).find(":selected").attr("data-selected","selected-area").siblings("option").removeAttr("data-selected")}),e("#wusd_city").change(function(){e(this).find(":selected").attr("data-selected","selected-city").siblings("option").removeAttr("data-selected")}),e("#wusd_warehouse").change(function(){e(this).find(":selected").attr("data-selected","selected-warehouse").siblings("option").removeAttr("data-selected")}),e.ajax({type:"GET",data:"action=wusd_get_areas",url:ajaxurl.url,success:function(e){!function(e,t){var o=t,n=Object.keys(t).length;i(e,r="<option value='0' selected='selected'>Выберите область</option>");for(var a=0;a<n;a++){var r="<option value='"+o[a].Ref+"' title='"+o[a].Description+"'>"+o[a].Description+"</option>";i(e,r)}}(".wusd_area",e=JSON.parse(e))},error:function(e){}}),e.ajax({type:"GET",data:"action=wusd_get_city_sender",url:ajaxurl.url,success:function(e){t.ref=e},error:function(e){console.log("error")}}),e.ajax({type:"GET",data:"action=wusd_get_total_goods_price",url:ajaxurl.url,success:function(e){a.cost=e},error:function(e){console.log("error")}}),e(".wusd_area").on("change",function(){var t=e(".wusd_area option:selected").val();e.ajax({type:"GET",data:"area="+t+"&action=wusd_get_cities",url:ajaxurl.url,success:function(e){!function(e,t){c(e,"option");var o=t,n=Object.keys(t).length;i(e,r="<option value='0' selected='selected'>Выберите город</option>");for(var a=0;a<n;a++){var r="<option value='"+o[a].Ref+"'>"+o[a].Description+"</option>";i(e,r)}}(".wusd_city",e=JSON.parse(e))},error:function(e){console.log("error")}})}),e(".wusd_city").on("change",function(){var t=e(".wusd_city option:selected").text();e.ajax({type:"GET",data:"city="+t+"&action=wusd_get_warehouses",url:ajaxurl.url,success:function(e){!function(e,t){c(e,"option");var o=t,n=Object.keys(t).length,a=document.getElementById("total_int").textContent;let r;r=parseFloat(a)<=30||n<3?o.filter(e=>e.PlaceMaxWeightAllowed):o.filter(e=>e.PlaceMaxWeightAllowed>30);var s="<option value='0' selected='selected'>Выберите отделение</option>";i(e,s),s="";for(var l=0;l<r.length;l++)s+="<option value='"+r[l].Ref+"'>"+r[l].Description+"</option>";i(e,s)}(".wusd_warehouse",e=JSON.parse(e))},error:function(e){console.log("error")}}),e.ajax({type:"GET",data:"city="+t+"&action=wusd_get_city_recepient",url:ajaxurl.url,success:function(e){e=JSON.parse(e);console.log(e),o.ref=e},error:function(e){console.log("error")}})}),e(".wusd_shippingtype").on("change",function(){var t=e(".wusd_shippingtype option:selected").val();r.type=t}),e("#wusd_shippingtype").on("change",function(){l()});const l=()=>{let c={modelName:"InternetDocument",calledMethod:"getDocumentPrice",methodProperties:{CitySender:t.ref,CityRecipient:o.ref,Weight:n,ServiceType:r.type,Cost:a.cost,CargoType:s,SeatsAmount:"1"},apiKey:"264fb844abef16e84663f922267df5fd"};return fetch("https://api.novaposhta.ua/v2.0/json/",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(c)}).then(e=>e.json()).then(t=>(function(t){var o=e("#shipping_method_0_nova_poshta_shipping").val();e.ajax({type:"POST",data:"cost="+t.Cost+"&shipping_method="+o+"&action=wusd_change_shipping_cost",url:ajaxurl.url,success:function(t){e("body").trigger("update_checkout"),console.log(t)},error:function(e){console.error("Error")}})})(t.data[0])).catch(e=>console.warn(e))}}(jQuery);